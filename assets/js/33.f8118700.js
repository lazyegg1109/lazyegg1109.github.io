(window.webpackJsonp=window.webpackJsonp||[]).push([[33],{525:function(a,s,t){"use strict";t.r(s);var n=t(3),e=Object(n.a)({},(function(){var a=this,s=a._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h3",{attrs:{id:"官网"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#官网"}},[a._v("#")]),a._v(" 官网")]),a._v(" "),s("p",[a._v("https://nacos.io/")]),a._v(" "),s("p",[a._v("https://github.com/alibaba/nacos/releases")]),a._v(" "),s("h3",{attrs:{id:"linux安装nacos"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#linux安装nacos"}},[a._v("#")]),a._v(" Linux安装nacos")]),a._v(" "),s("h4",{attrs:{id:"安装jdk环境"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装jdk环境"}},[a._v("#")]),a._v(" 安装jdk环境")]),a._v(" "),s("p",[a._v("然后解压缩：")]),a._v(" "),s("div",{staticClass:"language-sh line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("tar")]),a._v(" -xvf jdk-8u144-linux-x64.tar.gz\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("然后重命名为java")]),a._v(" "),s("p",[a._v("配置环境变量：")]),a._v(" "),s("div",{staticClass:"language-sh line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("export")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("JAVA_HOME")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("/usr/local/java\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("export")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s("span",{pre:!0,attrs:{class:"token environment constant"}},[a._v("PATH")])]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token environment constant"}},[a._v("$PATH")]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$JAVA_HOME")]),a._v("/bin\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br")])]),s("p",[a._v("设置环境变量：")]),a._v(" "),s("div",{staticClass:"language-sh line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("source")]),a._v(" /etc/profile\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("h4",{attrs:{id:"上传nacos安装包"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#上传nacos安装包"}},[a._v("#")]),a._v(" 上传nacos安装包")]),a._v(" "),s("p",[a._v("上传到Linux服务器的某个目录，例如"),s("code",[a._v("/usr/local/src")]),a._v("目录下")]),a._v(" "),s("h4",{attrs:{id:"解压"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#解压"}},[a._v("#")]),a._v(" 解压")]),a._v(" "),s("p",[a._v("命令解压缩安装包：")]),a._v(" "),s("div",{staticClass:"language-sh line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("tar")]),a._v(" -xvf nacos-server-1.4.1.tar.gz\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("然后删除安装包：")]),a._v(" "),s("div",{staticClass:"language-sh line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("rm")]),a._v(" -rf nacos-server-1.4.1.tar.gz\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("h4",{attrs:{id:"配置云端口"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置云端口"}},[a._v("#")]),a._v(" 配置云端口")]),a._v(" "),s("p",[a._v("默认端口为8848")]),a._v(" "),s("p",[a._v("改端口：/nacos/conf下的application.properties")]),a._v(" "),s("h4",{attrs:{id:"启动"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#启动"}},[a._v("#")]),a._v(" 启动")]),a._v(" "),s("p",[a._v("在nacos/bin目录中，输入命令启动Nacos：")]),a._v(" "),s("div",{staticClass:"language-sh line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sh")]),a._v(" startup.sh -m standalone\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("h3",{attrs:{id:"nacos的依赖"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#nacos的依赖"}},[a._v("#")]),a._v(" Nacos的依赖")]),a._v(" "),s("p",[a._v("父工程：")]),a._v(" "),s("div",{staticClass:"language-xml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-xml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("dependency")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("com.alibaba.cloud"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("spring-cloud-alibaba-dependencies"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("version")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("2.2.5.RELEASE"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("version")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("type")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("pom"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("type")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("scope")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("import"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("scope")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("dependency")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br")])]),s("p",[a._v("客户端：")]),a._v(" "),s("div",{staticClass:"language-xml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-xml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("\x3c!-- nacos客户端依赖包 --\x3e")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("dependency")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("com.alibaba.cloud"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("spring-cloud-starter-alibaba-nacos-discovery"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("dependency")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br")])]),s("h3",{attrs:{id:"配置文件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置文件"}},[a._v("#")]),a._v(" 配置文件")]),a._v(" "),s("div",{staticClass:"language-xml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-xml"}},[s("code",[a._v("spring:\n  application:\n    name: orderservice\n  cloud:\n    nacos:\n      server-addr: ip:8848\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br")])]),s("h3",{attrs:{id:"nacos控制台"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#nacos控制台"}},[a._v("#")]),a._v(" Nacos控制台")]),a._v(" "),s("p",[a._v("http://ip:8848/nacos")]),a._v(" "),s("p",[a._v("账号：nacos")]),a._v(" "),s("p",[a._v("密码：nacos")]),a._v(" "),s("h3",{attrs:{id:"nacos配置集群"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#nacos配置集群"}},[a._v("#")]),a._v(" Nacos配置集群")]),a._v(" "),s("p",[a._v("yml配置文件修改")]),a._v(" "),s("div",{staticClass:"language-xml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-xml"}},[s("code",[a._v("cloud:\n    nacos:\n      server-addr: ip:8848\n      discovery:\n        cluster-name: SH  #集群名称\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br")])]),s("h3",{attrs:{id:"nacosrule负载均衡"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#nacosrule负载均衡"}},[a._v("#")]),a._v(" NacosRule负载均衡")]),a._v(" "),s("p",[a._v("在默认情况下，即使集群地点相同，还是不会地点优先，业务默认走的是负载均衡的轮询方式。")]),a._v(" "),s("p",[a._v("没有NacosRule配置之前如下：")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("userservice:\n  ribbon:\n    NFLoadBalancerRuleClassName: com.netflix.loadbalancer.RandomRule\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br")])]),s("p",[a._v("RandomRule为随机")]),a._v(" "),s("p",[a._v("只需要改为如下即可：")]),a._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[a._v("userservice"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v("\n  ribbon"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("NFLoadBalancerRuleClassName")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[s("span",{pre:!0,attrs:{class:"token namespace"}},[a._v("com"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("alibaba"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("cloud"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("nacos"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("ribbon"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")])]),a._v("NacosRule")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br")])]),s("p",[a._v("NacosRule首先选择本地集群，然后在本地集群中进行随机选择")]),a._v(" "),s("p",[a._v("跨集群访问会报警告信息：")]),a._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("A")]),a._v(" cross"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("cluster call occurs，name "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" userservice"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" clusterName "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" HZ"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" instance "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Instance")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("instanceId"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("'"),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("10.44")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v(".150")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v(".161")]),a._v("#"),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("8083")]),a._v("#SH#DEFAULT_GROUP@"),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@userservice")]),s("span",{pre:!0,attrs:{class:"token char"}},[a._v("', ip='")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("10.44")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v(".150")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v(".161")]),a._v("'"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" port"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("8083")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" weight"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1.0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" healthy"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("true")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" enabled"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("true")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" ephemeral"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("true")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" clusterName"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token char"}},[a._v("'SH'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" serviceName"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("'DEFAULT_GROUP@"),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@userservice")]),a._v("'"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" metadata"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("preserved"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("register"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("source"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("SPRING_CLOUD"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("h3",{attrs:{id:"nacosrule根据权重负载均衡"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#nacosrule根据权重负载均衡"}},[a._v("#")]),a._v(" NacosRule根据权重负载均衡")]),a._v(" "),s("p",[a._v("只需要在控制台中对集群进行“编辑”，设置“权重”的值，1为最大，0为最小")]),a._v(" "),s("p",[a._v("权重为0的作用：停机迭代升级。")]),a._v(" "),s("h3",{attrs:{id:"nacos环境隔离-namespace命名空间"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#nacos环境隔离-namespace命名空间"}},[a._v("#")]),a._v(" Nacos环境隔离（namespace命名空间）")]),a._v(" "),s("p",[a._v("在控制台中的“命名空间”打开，点击“新建命名空间”进行新建。")]),a._v(" "),s("p",[a._v("默认为public空间。")]),a._v(" "),s("p",[a._v("层级关系：")]),a._v(" "),s("p",[a._v("Namespace--\x3eGroup--\x3eService/Data")]),a._v(" "),s("p",[a._v("Group：业务相关度高的可以放到一个组，比如订单和支付")]),a._v(" "),s("p",[a._v("代码配置：")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("cloud:\n    nacos:\n      server-addr: ip:8848\n      discovery:\n        cluster-name: HZ\n        namespace: 521a6649-a8cf-4eda-bbc4-7ce8e18f88a6\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br")])]),s("p",[a._v("配置namespace，值为创建命名空间时生成的id。")]),a._v(" "),s("p",[a._v("配置完环境隔离后，如果访问不同环境下的接口，会报错误提示：")]),a._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("No")]),a._v(" instances available "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("for")]),a._v(" userservice"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("with")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token namespace"}},[a._v("root")]),a._v(" cause\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("h3",{attrs:{id:"nacos临时实例和非临时实例"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#nacos临时实例和非临时实例"}},[a._v("#")]),a._v(" Nacos临时实例和非临时实例")]),a._v(" "),s("p",[a._v("默认为临时实例")]),a._v(" "),s("p",[a._v("修改yml如下")]),a._v(" "),s("div",{staticClass:"language-xml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-xml"}},[s("code",[a._v("cloud:\n    nacos:\n      server-addr: 43.138.140.213:8848\n      discovery:\n        cluster-name: HZ\n        namespace: 521a6649-a8cf-4eda-bbc4-7ce8e18f88a6\n        ephemeral: false\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br")])]),s("p",[a._v("区别：")]),a._v(" "),s("p",[a._v("临时实例的服务停掉了之后，在nacos中不会立刻消失，因为询问有时间，存在的是缓存而已。")]),a._v(" "),s("p",[a._v("非临时实例的服务停掉之后，在nacos会立刻变红色，并且不会消失，nacos会一直等他重新启动。")]),a._v(" "),s("h3",{attrs:{id:"nacos统一配置管理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#nacos统一配置管理"}},[a._v("#")]),a._v(" Nacos统一配置管理")]),a._v(" "),s("p",[a._v("目的：当集群的服务器太多的时候，做到对配置文件的统一管理，使得配置文件被修改后，服务器都能识别到，然后进行重新读取。")]),a._v(" "),s("p",[a._v("在控制台中点击“配置管理”，点击“新建配置”。")]),a._v(" "),s("p",[a._v("Date ID：一定要唯一，一般用微服务的服务名进行命名，后缀名不能为yml，要为yaml。")]),a._v(" "),s("p",[a._v("配置内容：一般不需要把yaml中的配置项全部复制粘贴，只需要一些开关类的配置即可。")]),a._v(" "),s("h3",{attrs:{id:"nacos配置管理的读取"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#nacos配置管理的读取"}},[a._v("#")]),a._v(" Nacos配置管理的读取")]),a._v(" "),s("p",[a._v("没有Nacos之前，项目读取配置文件的过程如下：")]),a._v(" "),s("p",[a._v("项目启动--\x3e读取本地配置文件application.yml--\x3e创建apring容器--\x3e加载bean")]),a._v(" "),s("p",[a._v("加入Nacos之后：")]),a._v(" "),s("p",[a._v("先读取Nacos配置文件，再读取本地配置文件，两者合并。")]),a._v(" "),s("p",[a._v("注意！！因为Nacos的地址是放在本地配置中的，但是读取顺序是先Nacos再本地，所以要另想办法。")]),a._v(" "),s("p",[a._v("解决方案：因为bootstrap.yml的读取时比application.yml前，所以将有关nacos的配置放入bootstrap.yml中。")]),a._v(" "),s("p",[a._v("导入依赖：")]),a._v(" "),s("div",{staticClass:"language-xml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-xml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("dependency")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n            "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("com.alibaba.cloud"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n            "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("spring-cloud-starter-alibaba-nacos-config"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("dependency")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br")])]),s("p",[a._v("创建bootstrap.yaml")]),a._v(" "),s("div",{staticClass:"language-yaml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("spring")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("application")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" userservice  "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#对应名称")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("profiles")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("active")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" dev\t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#对应环境（-后面的内容）")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("cloud")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("nacos")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("server-addr")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" ip"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("8848")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("config")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("file-extension")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" yaml  "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#文件后缀名")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br")])]),s("p",[a._v("注入方式1：")]),a._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@Value")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"${pattern.dateformat}"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("private")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("String")]),a._v(" dateformat"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br")])]),s("h3",{attrs:{id:"nacos配置热更新-自动刷新"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#nacos配置热更新-自动刷新"}},[a._v("#")]),a._v(" Nacos配置热更新（自动刷新）")]),a._v(" "),s("p",[a._v("nacos默认不会自动更新，需要手动配置。")]),a._v(" "),s("p",[a._v("在相对应的配置数据读取的类上加上@RefreshScope即可")]),a._v(" "),s("h3",{attrs:{id:"nacos配置注入方式"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#nacos配置注入方式"}},[a._v("#")]),a._v(" Nacos配置注入方式")]),a._v(" "),s("p",[a._v("1.@Value注解，热更新需要在类上加上@RefreshScope注解")]),a._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@RefreshScope")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("class")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("UserController")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@Value")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"${pattern.dateformat}"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("private")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("String")]),a._v(" dateformat"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br")])]),s("p",[a._v("2.使用@ConfigurationProperties注解")]),a._v(" "),s("p",[a._v("创建配置类：")]),a._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@Data")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@Component")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@ConfigurationProperties")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("prefix "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"pattern"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("class")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("PatternProperties")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("private")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("String")]),a._v(" dateformat"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br")])]),s("p",[a._v("在使用的地方注入进来即可，使用@ConfigurationProperties的方法可以不加@RefreshScope，它会默认进行热更新")]),a._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[a._v(" "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@Autowired")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("private")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("PatternProperties")]),a._v(" patternProperties"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br")])]),s("h3",{attrs:{id:"nacos多环境配置共享"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#nacos多环境配置共享"}},[a._v("#")]),a._v(" Nacos多环境配置共享")]),a._v(" "),s("p",[a._v("微服务启动时会从nacos读取多个配置文件")]),a._v(" "),s("ul",[s("li",[a._v("[spring.application.name]-[spqing.profiles.active].yaml，例如userservice-dev.yaml")]),a._v(" "),s("li",[a._v("[spring.application.name].yaml，例如userservice.yaml")])]),a._v(" "),s("p",[a._v("分析：例如userservice.yaml这种文件，是不会改变的，可以用来做配置共享")]),a._v(" "),s("p",[a._v("idea中为了不重复修改配置代码进行重启，可以点击下方Services中需要改开发环境的项目，右键Edit，Active profiles修改为相对应的环境名字就行。")]),a._v(" "),s("p",[a._v("环境配置共享几点注意事项：")]),a._v(" "),s("ul",[s("li",[a._v("当本地有配置属性，nacos上没有时，走的是本地")]),a._v(" "),s("li",[a._v("当本地和nacos上都有相同属性名的值时，优先走nacos")]),a._v(" "),s("li",[a._v("当nacos上的dev环境也添加相同配置属性名的值时，dev优先")])]),a._v(" "),s("p",[a._v("总结：服务名-profile.yaml(当前环境) > 服务名.yaml(共享环境) > 本地配置")]),a._v(" "),s("h3",{attrs:{id:"nacos集群搭建"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#nacos集群搭建"}},[a._v("#")]),a._v(" Nacos集群搭建")])])}),[],!1,null,null,null);s.default=e.exports}}]);
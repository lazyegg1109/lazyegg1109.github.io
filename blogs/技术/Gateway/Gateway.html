<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Gateway网关 | 早睡蛋</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/favicon.ico">
    <meta name="description" content="早睡蛋blog">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    
    <link rel="preload" href="/assets/css/0.styles.c1c54ca7.css" as="style"><link rel="preload" href="/assets/js/app.1bdcbdf6.js" as="script"><link rel="preload" href="/assets/js/4.85ed13de.js" as="script"><link rel="preload" href="/assets/js/1.664a606a.js" as="script"><link rel="preload" href="/assets/js/10.3e59fe0a.js" as="script"><link rel="preload" href="/assets/js/18.4500ac4b.js" as="script"><link rel="prefetch" href="/assets/js/11.2df8005d.js"><link rel="prefetch" href="/assets/js/12.f34ec6e9.js"><link rel="prefetch" href="/assets/js/13.dd89da0f.js"><link rel="prefetch" href="/assets/js/14.617117b9.js"><link rel="prefetch" href="/assets/js/15.093eb6c6.js"><link rel="prefetch" href="/assets/js/16.6814dc7f.js"><link rel="prefetch" href="/assets/js/17.ae45a605.js"><link rel="prefetch" href="/assets/js/19.06409e97.js"><link rel="prefetch" href="/assets/js/20.118477f8.js"><link rel="prefetch" href="/assets/js/21.1162d5ca.js"><link rel="prefetch" href="/assets/js/22.98a7f46f.js"><link rel="prefetch" href="/assets/js/23.c66d34f6.js"><link rel="prefetch" href="/assets/js/24.d81562f1.js"><link rel="prefetch" href="/assets/js/25.74131133.js"><link rel="prefetch" href="/assets/js/26.bdbaf10c.js"><link rel="prefetch" href="/assets/js/27.0b01c48b.js"><link rel="prefetch" href="/assets/js/28.390e4ae8.js"><link rel="prefetch" href="/assets/js/29.c608b3dd.js"><link rel="prefetch" href="/assets/js/3.42df50d2.js"><link rel="prefetch" href="/assets/js/30.0d9bf569.js"><link rel="prefetch" href="/assets/js/31.e67afd51.js"><link rel="prefetch" href="/assets/js/32.a9cb2b7b.js"><link rel="prefetch" href="/assets/js/33.f8118700.js"><link rel="prefetch" href="/assets/js/34.e4a4a75e.js"><link rel="prefetch" href="/assets/js/35.3388bfa8.js"><link rel="prefetch" href="/assets/js/36.0842c3b5.js"><link rel="prefetch" href="/assets/js/37.e034b951.js"><link rel="prefetch" href="/assets/js/38.a5a6fc4e.js"><link rel="prefetch" href="/assets/js/39.be174d84.js"><link rel="prefetch" href="/assets/js/40.abc6f423.js"><link rel="prefetch" href="/assets/js/41.2478caab.js"><link rel="prefetch" href="/assets/js/42.3407afbe.js"><link rel="prefetch" href="/assets/js/43.f2424e0d.js"><link rel="prefetch" href="/assets/js/44.e782c571.js"><link rel="prefetch" href="/assets/js/45.0d212137.js"><link rel="prefetch" href="/assets/js/46.1c10fb6a.js"><link rel="prefetch" href="/assets/js/47.3e241769.js"><link rel="prefetch" href="/assets/js/48.ac980c57.js"><link rel="prefetch" href="/assets/js/49.091b9e5e.js"><link rel="prefetch" href="/assets/js/5.c6e6b485.js"><link rel="prefetch" href="/assets/js/50.9358471e.js"><link rel="prefetch" href="/assets/js/51.a537c253.js"><link rel="prefetch" href="/assets/js/52.0996ec87.js"><link rel="prefetch" href="/assets/js/53.d1cfe997.js"><link rel="prefetch" href="/assets/js/54.cfa9c3c5.js"><link rel="prefetch" href="/assets/js/55.25901041.js"><link rel="prefetch" href="/assets/js/56.8fc9610d.js"><link rel="prefetch" href="/assets/js/57.01411b56.js"><link rel="prefetch" href="/assets/js/58.5d35c4da.js"><link rel="prefetch" href="/assets/js/6.c3fb6481.js"><link rel="prefetch" href="/assets/js/7.47866055.js"><link rel="prefetch" href="/assets/js/8.52f04ce0.js"><link rel="prefetch" href="/assets/js/9.fa1e81de.js">
    <link rel="stylesheet" href="/assets/css/0.styles.c1c54ca7.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar" data-v-5bb33761><div data-v-5bb33761><div class="password-shadow password-wrapper-out" style="display:none;" data-v-59e6cb88 data-v-5bb33761 data-v-5bb33761><h3 class="title" data-v-59e6cb88>早睡蛋</h3> <p class="description" data-v-59e6cb88>早睡蛋blog</p> <label id="box" class="inputBox" data-v-59e6cb88><input type="password" value="" data-v-59e6cb88> <span data-v-59e6cb88>Konck! Knock!</span> <button data-v-59e6cb88>OK</button></label> <div class="footer" data-v-59e6cb88><span data-v-59e6cb88><i class="iconfont reco-theme" data-v-59e6cb88></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-59e6cb88>vuePress-theme-reco</a></span> <span data-v-59e6cb88><i class="iconfont reco-copyright" data-v-59e6cb88></i> <a data-v-59e6cb88><span data-v-59e6cb88>早睡蛋</span>
          
        <span data-v-59e6cb88>2022 - </span>
        2023
      </a></span></div></div> <div class="hide" data-v-5bb33761><header class="navbar" data-v-5bb33761><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo.png" alt="早睡蛋" class="logo"> <span class="site-name">早睡蛋</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      栏目
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/技术/" class="nav-link"><i class="undefined"></i>
  技术
</a></li><li class="dropdown-item"><!----> <a href="/categories/Java基础/" class="nav-link"><i class="undefined"></i>
  Java基础
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  标签
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  时间线
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      更多
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/theme-reco/" class="nav-link"><i class="undefined"></i>
  笔记
</a></li><li class="dropdown-item"><!----> <a href="/docs/java-map-project/" class="nav-link"><i class="undefined"></i>
  百度地图项目
</a></li><li class="dropdown-item"><!----> <a href="/docs/lock-study/" class="nav-link"><i class="undefined"></i>
  分布式锁
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-5bb33761></div> <aside class="sidebar" data-v-5bb33761><div class="personal-info-wrapper" data-v-3f376b07 data-v-5bb33761><img src="/avatar.jpg" alt="author-avatar" class="personal-img" data-v-3f376b07> <h3 class="name" data-v-3f376b07>
    早睡蛋
  </h3> <div class="num" data-v-3f376b07><div data-v-3f376b07><h3 data-v-3f376b07>12</h3> <h6 data-v-3f376b07>文章数</h6></div> <div data-v-3f376b07><h3 data-v-3f376b07>24</h3> <h6 data-v-3f376b07>标签数</h6></div></div> <ul class="social-links" data-v-3f376b07></ul> <hr data-v-3f376b07></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      栏目
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/技术/" class="nav-link"><i class="undefined"></i>
  技术
</a></li><li class="dropdown-item"><!----> <a href="/categories/Java基础/" class="nav-link"><i class="undefined"></i>
  Java基础
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  标签
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  时间线
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      更多
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/theme-reco/" class="nav-link"><i class="undefined"></i>
  笔记
</a></li><li class="dropdown-item"><!----> <a href="/docs/java-map-project/" class="nav-link"><i class="undefined"></i>
  百度地图项目
</a></li><li class="dropdown-item"><!----> <a href="/docs/lock-study/" class="nav-link"><i class="undefined"></i>
  分布式锁
</a></li></ul></div></div> <!----></nav> <!----> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-59e6cb88 data-v-5bb33761><h3 class="title" data-v-59e6cb88>Gateway网关</h3> <!----> <label id="box" class="inputBox" data-v-59e6cb88><input type="password" value="" data-v-59e6cb88> <span data-v-59e6cb88>Konck! Knock!</span> <button data-v-59e6cb88>OK</button></label> <div class="footer" data-v-59e6cb88><span data-v-59e6cb88><i class="iconfont reco-theme" data-v-59e6cb88></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-59e6cb88>vuePress-theme-reco</a></span> <span data-v-59e6cb88><i class="iconfont reco-copyright" data-v-59e6cb88></i> <a data-v-59e6cb88><span data-v-59e6cb88>早睡蛋</span>
          
        <span data-v-59e6cb88>2022 - </span>
        2023
      </a></span></div></div> <div data-v-5bb33761><div data-v-5bb33761><main class="page"><section style="display:;"><div class="page-title"><h1 class="title">Gateway网关</h1> <div data-v-8a445198><i class="iconfont reco-account" data-v-8a445198><span data-v-8a445198>早睡蛋</span></i> <i class="iconfont reco-date" data-v-8a445198><span data-v-8a445198>8/3/2022</span></i> <!----> <i class="tags iconfont reco-tag" data-v-8a445198><span class="tag-item" data-v-8a445198>SpringCloud</span><span class="tag-item" data-v-8a445198>Gateway</span><span class="tag-item" data-v-8a445198>技术</span><span class="tag-item" data-v-8a445198>网关</span><span class="tag-item" data-v-8a445198>拦截器</span></i></div></div> <div class="theme-reco-content content__default"><div class="custom-block tip"><p class="title"></p><p>SpringCloud Alibaba中的Gateway网关学习</p></div> <h3 id="为什么需要网关"><a href="#为什么需要网关" class="header-anchor">#</a> 为什么需要网关</h3> <p><img src="/assets/img/image-20220803143310988.d3d7d520.png" alt="image-20220803143310988"></p> <p>网关的功能：</p> <ul><li>身份认证和权限校验</li> <li>服务路由、负载均衡</li> <li>请求限流</li></ul> <h3 id="网关的技术实现"><a href="#网关的技术实现" class="header-anchor">#</a> 网关的技术实现</h3> <p>SpringCloud中网关有两种：</p> <ul><li>gateway</li> <li>zuul</li></ul> <p>Zuul是基于Servlet的实现，属于阻塞式编程。</p> <p>而SpringCloudGateway则是基于Spring5中提供的WebFlux，属于响应式编程的实现，具备更好的性能。</p> <h3 id="搭建网关服务"><a href="#搭建网关服务" class="header-anchor">#</a> 搭建网关服务</h3> <p>1、创建新的模块来单独搭建gateway网关，先引入两个依赖：</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token comment">&lt;!--网关依赖--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>  
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-gateway<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!--nacos服务发现依赖--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span> 
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>   
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-alibaba-nacos-discovery<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>创建启动类：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GatewayApplication</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">GatewayApplication</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>2、编写路由配置以及nacos地址</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">10010</span> <span class="token comment"># 网关端口</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> gateway <span class="token comment"># 服务名称</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
      <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8848</span> <span class="token comment"># nacos地址</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span> <span class="token comment"># 网关路由配置</span>
        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> user<span class="token punctuation">-</span>service <span class="token comment"># 路由id，自定义，只要唯一即可</span>
          <span class="token comment"># uri: http://127.0.0.1:8081 # 路由的目标地址 http就是固定地址</span>
          <span class="token key atrule">uri</span><span class="token punctuation">:</span> lb<span class="token punctuation">:</span>//userservice <span class="token comment"># 路由的目标地址 lb就是负载均衡，后面跟服务名称</span>
          <span class="token key atrule">predicates</span><span class="token punctuation">:</span> <span class="token comment"># 路由断言，也就是判断请求是否符合路由规则的条件</span>
            <span class="token punctuation">-</span> Path=/user/<span class="token important">**</span> <span class="token comment"># 这个是按照路径匹配，只要以/user/开头就符合要求</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>若要再代理多一个服务，则从-id开始，模仿第一个来添加：</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span> <span class="token comment"># 网关路由配置</span>
        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> user<span class="token punctuation">-</span>service <span class="token comment"># 路由id，自定义，只要唯一即可</span>
          <span class="token comment"># uri: http://127.0.0.1:8081 # 路由的目标地址 http就是固定地址</span>
          <span class="token key atrule">uri</span><span class="token punctuation">:</span> lb<span class="token punctuation">:</span>//userservice <span class="token comment"># 路由的目标地址 lb就是负载均衡，后面跟服务名称</span>
          <span class="token key atrule">predicates</span><span class="token punctuation">:</span> <span class="token comment"># 路由断言，也就是判断请求是否符合路由规则的条件</span>
            <span class="token punctuation">-</span> Path=/user/<span class="token important">**</span> <span class="token comment"># 这个是按照路径匹配，只要以/user/开头就符合要求</span>
        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> order<span class="token punctuation">-</span>service
          <span class="token key atrule">uri</span><span class="token punctuation">:</span> lb<span class="token punctuation">:</span>//orderservice
          <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> Path=/order/<span class="token important">**</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>启动服务后，直接访问网关的端口号加请求名称http://localhost:10010/user/1</p> <p>请求成功：</p> <p><img src="data:image/png;base64,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" alt="image-20220803145844136"></p> <h3 id="网关服务的流程"><a href="#网关服务的流程" class="header-anchor">#</a> 网关服务的流程</h3> <p><img src="/assets/img/image-20220803150107859.833a961e.png" alt="image-20220803150107859"></p> <h3 id="路由断言工厂-route-predicate-factory"><a href="#路由断言工厂-route-predicate-factory" class="header-anchor">#</a> 路由断言工厂(Route Predicate Factory)</h3> <p>网关路由可以配置的内容包括：</p> <ul><li>路由id：路由唯一标示</li> <li>uri：路由目的地，支持lb和http两种</li> <li>predicates：路由断言，判断请求是否符合要求，符合则转发到路由目的地</li> <li>filters：路由过滤器，处理请求或响应</li></ul> <p>说明：</p> <ul><li>我们在配置文件中写的断言规则只是字符串，这些字符串会被Predicate Factory读取并处理，转变为路由判断的条件</li> <li>例如Path=/user/**是按照路径匹配，这个规则是由org.springframework.cloud.gateway.handler.predicate.PathRoutePredicateFactory类来处理的</li> <li>像这样的断言工厂在SpringCloudGateway还有十几个</li></ul> <p>Spring提供了11中基本的Predicate工厂：</p> <p><img src="/assets/img/image-20220803150816314.116a2719.png" alt="image-20220803150816314"></p> <p>可以参照spring的官方网站，上面有对这些断言的使用讲解：</p> <p>https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#gateway-request-predicates-factories</p> <p>例子：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>predicates<span class="token operator">:</span>
            <span class="token operator">-</span> <span class="token class-name">Path</span><span class="token operator">=</span><span class="token operator">/</span>order<span class="token comment">/**
            - After=2022-08-03T15:15:00.789+08:00[Asia/Shanghai]
</span></code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>这里选择了After断言规则，表示在这个时间之后的请求才能通过。否则会报404的错误。</p> <h3 id="断言工厂小结"><a href="#断言工厂小结" class="header-anchor">#</a> 断言工厂小结</h3> <ul><li><p>PredicateFactory的作用是什么？</p> <p>读取用户定义的断言条件，对请求做出判断</p></li> <li><p>Path=/user/**是什么含义？</p> <p>路径是以/user开头的就认为是符合的</p></li></ul> <h3 id="路由过滤器-gatewayfilter"><a href="#路由过滤器-gatewayfilter" class="header-anchor">#</a> 路由过滤器(GatewayFilter)</h3> <p>GatewayFilter是网关中提供的一种过滤器，可以对进入网关的请求和微服务返回的响应做处理：</p> <p><img src="/assets/img/image-20220803151943736.38cfa448.png" alt="image-20220803151943736"></p> <h3 id="过滤器工厂-gatefilterfactory"><a href="#过滤器工厂-gatefilterfactory" class="header-anchor">#</a> 过滤器工厂（GateFilterFactory）</h3> <p>参考spring官方地址：</p> <p>https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#gatewayfilter-factories</p> <p>Spring提供了31种不同的过滤器，其中的有：</p> <p><img src="/assets/img/image-20220803152721884.93a070fd.png" alt="image-20220803152721884"></p> <h3 id="配置过滤器"><a href="#配置过滤器" class="header-anchor">#</a> 配置过滤器</h3> <p>官方例子：</p> <h3 id="the-addrequestheader-gatewayfilter-factory"><a href="#the-addrequestheader-gatewayfilter-factory" class="header-anchor">#</a> <a href="https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#the-addrequestheader-gatewayfilter-factory" target="_blank" rel="noopener noreferrer">The <code>AddRequestHeader</code> <code>GatewayFilter</code> Factory<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></h3> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> add_request_header_route
        <span class="token key atrule">uri</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//example.org
        <span class="token key atrule">filters</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> AddRequestHeader=X<span class="token punctuation">-</span>Request<span class="token punctuation">-</span>red<span class="token punctuation">,</span> blue
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><blockquote><p>This listing adds <code>X-Request-red:blue</code> header to the downstream request’s headers for all matching requests.</p></blockquote> <blockquote><p><code>AddRequestHeader</code> is aware of the URI variables used to match a path or host. URI variables may be used in the value and are expanded at runtime. The following example configures an <code>AddRequestHeader</code> <code>GatewayFilter</code> that uses a variable:</p></blockquote> <p>运用：</p> <p>在配置文件中添加filters配置：</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">filters</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> AddRequestHeader=Truth<span class="token punctuation">,</span>LazyEgg is Awesome<span class="token tag">!</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>现在已经配置完成，如何在后端直接看到请求头的数据呢？</p> <p>我们可以在controller层的接口中加上<code>@RequestHeader</code>的注解，这样就可以获取到指定的请求头中的参数：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/{id}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">queryById</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> id<span class="token punctuation">,</span> <span class="token annotation punctuation">@RequestHeader</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;Truth&quot;</span><span class="token punctuation">,</span>required <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token class-name">String</span> truth<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;truth:&quot;</span><span class="token operator">+</span>truth<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> userService<span class="token punctuation">.</span><span class="token function">queryById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>这样的话，通过测试，确实可以拿到请求头信息。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>truth:LazyEgg is Awesome!
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="配置默认过滤器-所有路由"><a href="#配置默认过滤器-所有路由" class="header-anchor">#</a> 配置默认过滤器(所有路由)</h3> <p>如果需要在所有路由上都配置相同的过滤器，则只需要在配置文件中配置default-filters，要注意，default-filters要与routes同级，这样就不会针对于某一个路由了，实现了所有路由过滤。</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">default-filters</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> AddRequestHeader=Truth<span class="token punctuation">,</span>SleepyEgg is Awesome2！
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>这样的话，通过测试是可以实现的。</p> <h3 id="过滤器工厂小结"><a href="#过滤器工厂小结" class="header-anchor">#</a> 过滤器工厂小结</h3> <ul><li><p>过滤器的作用是什么？</p> <p>①对路由的请求或响应做加工处理，比如添加请求头</p> <p>②配置在路由下的过滤器只对当前路由的请求生效</p></li> <li><p>defaultFilters的作用是什么？</p> <p>①对所有路由都生效的过滤器</p></li></ul> <h3 id="全局过滤器-globalfilter"><a href="#全局过滤器-globalfilter" class="header-anchor">#</a> 全局过滤器(GlobalFilter)</h3> <p>全局过滤器的作用也是处理一切进入网关的请求和微服务响应，与GatewayFilter的作用一样。</p> <p>区别在于GatewayFilter通过配置定义，处理逻辑是固定的。而GlobalFilter的逻辑需要自己写代码实现。定义方式是实现GlobalFilter接口。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">GlobalFilter</span> <span class="token punctuation">{</span>
    <span class="token comment">/**
     * 处理当前请求，有必要的话通过{@link GatewayFilterChain}将请求交给下一个过滤器处理
     *
     * @param exchange 请求上下文，里面可以获取Request、Response等信息
     * @param chain    用来把请求委托给下一个过滤器
     * @return {@code Mono&lt;Void&gt;} 返回标示当前过滤器业务结束
     */</span>
    <span class="token class-name">Mono</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> <span class="token function">filter</span><span class="token punctuation">(</span><span class="token class-name">ServerWebExchange</span> exchange<span class="token punctuation">,</span> <span class="token class-name">GatewayFilterChain</span> chain<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>说明：Mono类型是属于Spring5中WebFlux，WebFlux是<code>Spring5.0+SpringBoot2.0+WebFlux</code>等技术开发的，属于响应式编程。</p> <h3 id="全局过滤器实例"><a href="#全局过滤器实例" class="header-anchor">#</a> 全局过滤器实例</h3> <p>目的：拦截判断用户身份</p> <p>需求：定义全局过滤器，拦截请求，判断请求的参数是否满足下面条件：</p> <ul><li>参数中是否有authorization，</li> <li>authorization参数值是否为admin如果</li></ul> <p>同时满足则放行，否则拦截</p> <p>代码实现：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>gateway<span class="token punctuation">.</span>filter<span class="token punctuation">.</span></span><span class="token class-name">GatewayFilterChain</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>gateway<span class="token punctuation">.</span>filter<span class="token punctuation">.</span></span><span class="token class-name">GlobalFilter</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">Ordered</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>core<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Order</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpStatus</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>http<span class="token punctuation">.</span>server<span class="token punctuation">.</span>reactive<span class="token punctuation">.</span></span><span class="token class-name">ServerHttpRequest</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">MultiValueMap</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>server<span class="token punctuation">.</span></span><span class="token class-name">ServerWebExchange</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">reactor<span class="token punctuation">.</span>core<span class="token punctuation">.</span>publisher<span class="token punctuation">.</span></span><span class="token class-name">Mono</span></span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @Author 早睡蛋
 * @Date 2022/8/3 16:01:16
 * @Desc:
 */</span>
<span class="token annotation punctuation">@Component</span>
<span class="token comment">//@Order(-1)过滤器的顺序，也可以实现Ordered接口方法进行设置</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AuthorizeFilter</span> <span class="token keyword">implements</span> <span class="token class-name">GlobalFilter</span> <span class="token punctuation">,</span> <span class="token class-name">Ordered</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Mono</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> <span class="token function">filter</span><span class="token punctuation">(</span><span class="token class-name">ServerWebExchange</span> exchange<span class="token punctuation">,</span> <span class="token class-name">GatewayFilterChain</span> chain<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//1.获取请求参数</span>
        <span class="token class-name">ServerHttpRequest</span> request <span class="token operator">=</span> exchange<span class="token punctuation">.</span><span class="token function">getRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">MultiValueMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> params <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getQueryParams</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//2.获取参数中的 authorization 参数</span>
        <span class="token class-name">String</span> auth <span class="token operator">=</span> params<span class="token punctuation">.</span><span class="token function">getFirst</span><span class="token punctuation">(</span><span class="token string">&quot;authorization&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//getFirst为取出第一个匹配的</span>
        <span class="token comment">//3.判断参数数值是否等于 admin</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;admin&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>auth<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token comment">//4.是：放行</span>
            <span class="token keyword">return</span> chain<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>exchange<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//chain是链，会从过滤器链中找到下一个过滤器，等于放行</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//5.否：拦截</span>
        <span class="token comment">//5.1.设置状态码</span>
        exchange<span class="token punctuation">.</span><span class="token function">getResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setStatusCode</span><span class="token punctuation">(</span><span class="token class-name">HttpStatus</span><span class="token punctuation">.</span>UNAUTHORIZED<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//setStatusCode要传枚举类，UNAUTHORIZED为401，未登录的意思</span>
        <span class="token comment">//5.2.拦截请求</span>
        <span class="token keyword">return</span> exchange<span class="token punctuation">.</span><span class="token function">getResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setComplete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

		<span class="token comment">//过滤器执行的顺序</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br></div></div><p>再次发起请求，浏览器会报401（也就是我们自定义设置的未登录错误），若在请求中加上&quot;?authorization=admin&quot;则会访问成功。</p> <h3 id="过滤器执行顺序"><a href="#过滤器执行顺序" class="header-anchor">#</a> 过滤器执行顺序</h3> <p>请求进入网关会碰到三类过滤器：当前路由的过滤器、DefaultFilter、GlobalFilter请求路由后，会将当前路由过滤器和DefaultFilter、GlobalFilter，合并到一个过滤器链（集合）中，排序后依次执行每个过滤器</p> <p><img src="/assets/img/image-20220803162548814.21a070ab.png" alt="image-20220803162548814"></p> <ul><li>每一个过滤器都必须指定一个int类型的order值，order值越小，优先级越高，执行顺序越靠前。</li> <li>GlobalFilter通过实现Ordered接口，或者添加@Order注解来指定order值，由我们自己指定</li> <li>路由过滤器和defaultFilter的order由Spring指定，默认是按照声明顺序从1递增。当过滤器的order值一样时，会按照 defaultFilter &gt; 路由过滤器 &gt; GlobalFilter的顺序执行。</li></ul> <p>可以参考下面几个类的源码来查看：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>gateway<span class="token punctuation">.</span>route<span class="token punctuation">.</span></span>RouteDefinitionRouteLocator</span>#<span class="token function">getFilters</span><span class="token punctuation">(</span><span class="token punctuation">)</span>方法是先加载defaultFilters，然后再加载某个route的filters，然后合并。

<span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>gateway<span class="token punctuation">.</span>handler<span class="token punctuation">.</span></span>FilteringWebHandler</span>#<span class="token function">handle</span><span class="token punctuation">(</span><span class="token punctuation">)</span>方法会加载全局过滤器，与前面的过滤器合并后根据order排序，组织过滤器链

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="网关cors跨域处理"><a href="#网关cors跨域处理" class="header-anchor">#</a> 网关Cors跨域处理</h3> <p>跨域：域名不一致就是跨域，主要包括：</p> <ul><li>域名不同： www.taobao.com 和 www.taobao.org 和 www.jd.com 和 miaosha.jd.com</li> <li>域名相同，端口不同：localhost:8080和localhost8081</li></ul> <p>跨域问题：<strong>浏览器</strong>禁止请求的发起者与服务端发生跨域<strong>ajax请求</strong>，请求被浏览器拦截的问题</p> <p>解决方案：CORS</p> <h3 id="cors跨域配置"><a href="#cors跨域配置" class="header-anchor">#</a> CORS跨域配置</h3> <p>参照官网：https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#cors-configuration</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">globalcors</span><span class="token punctuation">:</span>
        <span class="token key atrule">cors-configurations</span><span class="token punctuation">:</span>
          <span class="token key atrule">'[/**]'</span><span class="token punctuation">:</span>
            <span class="token key atrule">allowedOrigins</span><span class="token punctuation">:</span> <span class="token string">&quot;https://docs.spring.io&quot;</span>
            <span class="token key atrule">allowedMethods</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> GET
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>注意：针对OPTIONS请求被拦截的问题，需要在上述配置中再加一条<code>add-to-simple-url-handler-mapping: true</code></p> <blockquote><p>To provide the same CORS configuration to requests that are not handled by some gateway route predicate, set the <code>spring.cloud.gateway.globalcors.add-to-simple-url-handler-mapping</code> property to <code>true</code>. This is useful when you try to support CORS preflight requests and your route predicate does not evalute to <code>true</code> because the HTTP method is <code>options</code>.</p></blockquote> <h4 id="配置详情"><a href="#配置详情" class="header-anchor">#</a> 配置详情</h4> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">globalcors</span><span class="token punctuation">:</span> <span class="token comment"># 全局的跨域处理</span>
        <span class="token key atrule">add-to-simple-url-handler-mapping</span><span class="token punctuation">:</span> <span class="token boolean important">true</span> <span class="token comment"># 解决options请求被拦截问题</span>
        <span class="token key atrule">corsConfigurations</span><span class="token punctuation">:</span>
          <span class="token key atrule">'[/**]'</span><span class="token punctuation">:</span> <span class="token comment">#拦截哪一些请求</span>
            <span class="token key atrule">allowedOrigins</span><span class="token punctuation">:</span> <span class="token comment"># 允许哪些网站的跨域请求</span>
              <span class="token punctuation">-</span> <span class="token string">&quot;http://localhost:8090&quot;</span>
              <span class="token punctuation">-</span> <span class="token string">&quot;http://www.baidu.com&quot;</span>
            <span class="token key atrule">allowedMethods</span><span class="token punctuation">:</span> <span class="token comment"># 允许的跨域ajax的请求方式</span>
              <span class="token punctuation">-</span> <span class="token string">&quot;GET&quot;</span>
              <span class="token punctuation">-</span> <span class="token string">&quot;POST&quot;</span>
              <span class="token punctuation">-</span> <span class="token string">&quot;DELETE&quot;</span>
              <span class="token punctuation">-</span> <span class="token string">&quot;PUT&quot;</span>
              <span class="token punctuation">-</span> <span class="token string">&quot;OPTIONS&quot;</span>
            <span class="token key atrule">allowedHeaders</span><span class="token punctuation">:</span> <span class="token string">&quot;*&quot;</span> <span class="token comment"># 允许在请求中携带的头信息</span>
            <span class="token key atrule">allowCredentials</span><span class="token punctuation">:</span> <span class="token boolean important">true</span> <span class="token comment"># 是否允许携带cookie</span>
            <span class="token key atrule">maxAge</span><span class="token punctuation">:</span> <span class="token number">360000</span> <span class="token comment"># 这次跨域检测的有效期</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div></div></section> <footer class="page-edit"><!----> <!----></footer> <!----> <div class="comments-wrapper"><!----></div> <ul class="side-bar sub-sidebar-wrapper" style="width:12rem;" data-v-ac050c62><li class="level-3" data-v-ac050c62><a href="/blogs/%E6%8A%80%E6%9C%AF/Gateway/Gateway.html#为什么需要网关" class="sidebar-link reco-side-为什么需要网关" data-v-ac050c62>为什么需要网关</a></li><li class="level-3" data-v-ac050c62><a href="/blogs/%E6%8A%80%E6%9C%AF/Gateway/Gateway.html#网关的技术实现" class="sidebar-link reco-side-网关的技术实现" data-v-ac050c62>网关的技术实现</a></li><li class="level-3" data-v-ac050c62><a href="/blogs/%E6%8A%80%E6%9C%AF/Gateway/Gateway.html#搭建网关服务" class="sidebar-link reco-side-搭建网关服务" data-v-ac050c62>搭建网关服务</a></li><li class="level-3" data-v-ac050c62><a href="/blogs/%E6%8A%80%E6%9C%AF/Gateway/Gateway.html#网关服务的流程" class="sidebar-link reco-side-网关服务的流程" data-v-ac050c62>网关服务的流程</a></li><li class="level-3" data-v-ac050c62><a href="/blogs/%E6%8A%80%E6%9C%AF/Gateway/Gateway.html#路由断言工厂-route-predicate-factory" class="sidebar-link reco-side-路由断言工厂-route-predicate-factory" data-v-ac050c62>路由断言工厂(Route Predicate Factory)</a></li><li class="level-3" data-v-ac050c62><a href="/blogs/%E6%8A%80%E6%9C%AF/Gateway/Gateway.html#断言工厂小结" class="sidebar-link reco-side-断言工厂小结" data-v-ac050c62>断言工厂小结</a></li><li class="level-3" data-v-ac050c62><a href="/blogs/%E6%8A%80%E6%9C%AF/Gateway/Gateway.html#路由过滤器-gatewayfilter" class="sidebar-link reco-side-路由过滤器-gatewayfilter" data-v-ac050c62>路由过滤器(GatewayFilter)</a></li><li class="level-3" data-v-ac050c62><a href="/blogs/%E6%8A%80%E6%9C%AF/Gateway/Gateway.html#过滤器工厂-gatefilterfactory" class="sidebar-link reco-side-过滤器工厂-gatefilterfactory" data-v-ac050c62>过滤器工厂（GateFilterFactory）</a></li><li class="level-3" data-v-ac050c62><a href="/blogs/%E6%8A%80%E6%9C%AF/Gateway/Gateway.html#配置过滤器" class="sidebar-link reco-side-配置过滤器" data-v-ac050c62>配置过滤器</a></li><li class="level-3" data-v-ac050c62><a href="/blogs/%E6%8A%80%E6%9C%AF/Gateway/Gateway.html#the-addrequestheader-gatewayfilter-factory" class="sidebar-link reco-side-the-addrequestheader-gatewayfilter-factory" data-v-ac050c62>The AddRequestHeader GatewayFilter Factory</a></li><li class="level-3" data-v-ac050c62><a href="/blogs/%E6%8A%80%E6%9C%AF/Gateway/Gateway.html#配置默认过滤器-所有路由" class="sidebar-link reco-side-配置默认过滤器-所有路由" data-v-ac050c62>配置默认过滤器(所有路由)</a></li><li class="level-3" data-v-ac050c62><a href="/blogs/%E6%8A%80%E6%9C%AF/Gateway/Gateway.html#过滤器工厂小结" class="sidebar-link reco-side-过滤器工厂小结" data-v-ac050c62>过滤器工厂小结</a></li><li class="level-3" data-v-ac050c62><a href="/blogs/%E6%8A%80%E6%9C%AF/Gateway/Gateway.html#全局过滤器-globalfilter" class="sidebar-link reco-side-全局过滤器-globalfilter" data-v-ac050c62>全局过滤器(GlobalFilter)</a></li><li class="level-3" data-v-ac050c62><a href="/blogs/%E6%8A%80%E6%9C%AF/Gateway/Gateway.html#全局过滤器实例" class="sidebar-link reco-side-全局过滤器实例" data-v-ac050c62>全局过滤器实例</a></li><li class="level-3" data-v-ac050c62><a href="/blogs/%E6%8A%80%E6%9C%AF/Gateway/Gateway.html#过滤器执行顺序" class="sidebar-link reco-side-过滤器执行顺序" data-v-ac050c62>过滤器执行顺序</a></li><li class="level-3" data-v-ac050c62><a href="/blogs/%E6%8A%80%E6%9C%AF/Gateway/Gateway.html#网关cors跨域处理" class="sidebar-link reco-side-网关cors跨域处理" data-v-ac050c62>网关Cors跨域处理</a></li><li class="level-3" data-v-ac050c62><a href="/blogs/%E6%8A%80%E6%9C%AF/Gateway/Gateway.html#cors跨域配置" class="sidebar-link reco-side-cors跨域配置" data-v-ac050c62>CORS跨域配置</a></li></ul></main></div> <!----></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div><!----><canvas id="vuepress-canvas-ribbon"></canvas><div></div></div></div>
    <script src="/assets/js/app.1bdcbdf6.js" defer></script><script src="/assets/js/4.85ed13de.js" defer></script><script src="/assets/js/1.664a606a.js" defer></script><script src="/assets/js/10.3e59fe0a.js" defer></script><script src="/assets/js/18.4500ac4b.js" defer></script>
  </body>
</html>
